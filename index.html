<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–Ω–∞–ª–∏–∑  –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  margin: 0;
}

.container {
  max-width: 1200px;
  margin: 40px auto;
  background: #fff;
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.1);
}

.upload-area {
  border: 3px dashed #667eea;
  border-radius: 15px;
  padding: 40px;
  text-align: center;
  margin-bottom: 30px;
  background: #f8f9ff;
  transition: 0.3s;
}

.upload-area.dragover {
  background: #e8ebff;
  border-color: #764ba2;
}

.upload-btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  padding: 15px 40px;
  border: none;
  border-radius: 10px;
  font-size: 1.1em;
  cursor: pointer;
}

.analyze-btn {
  background: linear-gradient(135deg, #f093fb, #f5576c);
  color: #fff;
  padding: 15px 40px;
  border: none;
  border-radius: 10px;
  font-size: 1.1em;
  cursor: pointer;
  margin-top: 20px;
}

.file-list {
  margin: 20px 0;
}

.file-item {
  background: #f8f9ff;
  padding: 15px;
  margin: 10px 0;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.file-name {
  color: #333;
  font-weight: 500;
}

.remove-btn {
  background: #ff4757;
  color: #fff;
  border: none;
  padding: 8px 15px;
  border-radius: 5px;
  cursor: pointer;
}

.loader {
  text-align: center;
  padding: 20px;
}

.spinner {
  border: 5px solid #f3f3f3;
  border-top: 5px solid #667eea;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  0% { transform: rotate(0deg);}
  100% { transform: rotate(360deg);}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–∏–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.stat-card {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  padding: 25px;
  border-radius: 15px;
  text-align: center;
}

.stat-card:nth-child(2) {
  background: linear-gradient(135deg, #f093fb, #f5576c);
}

.filter-buttons {
  margin: 20px 0 10px 0;
  display: flex;
  gap: 10px;
}

.filter-btn {
  padding: 10px 20px;
  border: 2px solid #667eea;
  background: #fff;
  color: #667eea;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}

.filter-btn.active {
  background: #667eea;
  color: #fff;
}

.differences-section {
  margin-top: 30px;
}

.file-differences {
  background: #f8f9ff;
  padding: 20px;
  border-radius: 10px;
  margin: 15px 0;
  border-left: 5px solid #667eea;
}

.toggle-icon { font-size: 1.2em; transition: 0.3s; }

.toggle-icon.expanded { transform: rotate(90deg); }

.sentences-container {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.sentences-container.expanded { max-height: 2000px; }

.sentence-item {
  padding: 10px;
  margin: 8px 0;
  border-radius: 5px;
  font-size: 0.95em;
  line-height: 1.6;
}

.unique-sentence {
  background: #e8f5e9;
  border-left: 4px solid #4caf50;
  color: #1b5e20;
}

.common-sentence {
  background: #fff3e0;
  border-left: 4px solid #ff9800;
  color: #e65100;
}

.sentence-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 3px;
  font-size: 0.8em;
  font-weight: bold;
  margin-left: 10px;
}

.badge-unique {
  background: #4caf50;
  color: #fff;
}

.badge-common {
  background: #ff9800;
  color: #fff;
}

.comparison-matrix {
  margin-top: 30px;
}

.matrix-cell {
  background: #f8f9ff;
  padding: 15px;
  border-radius: 10px;
  text-align: center;
}

.similarity-high { background: #ff4757; color: #fff; }
.similarity-medium { background: #ffa502; color: #fff; }
.similarity-low { background: #2ed573; color: #fff; }

  </style>
</head>
<body>
  <div class="container">
    <h1>üìÑ –ê–Ω–∞–ª–∏–∑  –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h1>
    <p class="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ 5 PDF-—Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–¥–æ 100 –ú–ë –∫–∞–∂–¥—ã–π!)</p>
    <div class="upload-area" id="uploadArea">
      <label for="fileInput">
        <span class="upload-btn">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</span>
      </label>
      <input type="file" id="fileInput" accept=".pdf" multiple>
      <p style="margin-top: 15px; color: #666;">–ú–∞–∫—Å–∏–º—É–º 5 —Ñ–∞–π–ª–æ–≤. Drag&Drop –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!</p>
    </div>
    <div class="file-list" id="fileList"></div>
    <button class="analyze-btn" id="analyzeBtn" disabled>üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</button>
    <div id="progressText" style="margin-top:20px; color:#667eea; min-height:1.5em;"></div>
<div id="fileProgress" style="margin-top: 3px; color: #888; font-size: 14px;"></div>
<div id="progressBar" style="background:#e0e0e0;border-radius:10px;height:20px;width:100%;margin-top:10px;overflow:hidden;">
  <div id="progressBarInner" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);height:100%;width:0%;transition:width .3s;"></div>
</div>

    <div class="results" id="results"></div>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    let selectedFiles = [];
    const maxFiles = 5;
    const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100 –ú–ë
    const BATCH_SIZE = 10; // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ 10 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑
    
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const fileList = document.getElementById('fileList');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const loader = document.getElementById('loader');
    const results = document.getElementById('results');
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
    fileInput.addEventListener('change', handleFileSelect);
    
    // Drag & Drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
        addFiles(files);
    });
    
    function handleFileSelect(e) {
        const files = Array.from(e.target.files);
        addFiles(files);
    }
    
    function addFiles(files) {
        files.forEach(file => {
            if (file.size > MAX_FILE_SIZE) {
                alert(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 100 –ú–ë)`);
                return;
            }
            
            if (selectedFiles.length < maxFiles && !selectedFiles.some(f => f.name === file.name)) {
                selectedFiles.push(file);
            }
        });
        
        updateFileList();
        analyzeBtn.disabled = selectedFiles.length < 2;
    }
    
    function updateFileList() {
        fileList.innerHTML = '';
        
        selectedFiles.forEach((file, index) => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            const sizeInMB = (file.size / 1024 / 1024).toFixed(2);
            fileItem.innerHTML = `
                <span class="file-name">üìÑ ${file.name} (${sizeInMB} –ú–ë)</span>
                <button class="remove-btn" onclick="removeFile(${index})">–£–¥–∞–ª–∏—Ç—å</button>
            `;
            fileList.appendChild(fileItem);
        });
    }
    
    function removeFile(index) {
        selectedFiles.splice(index, 1);
        updateFileList();
        analyzeBtn.disabled = selectedFiles.length < 2;
    }
    
    // –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–û–ï –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
    async function extractTextFromPDFOptimized(file, progressCallback) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({
            data: arrayBuffer,
            // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
            disableFontFace: true,      // –û—Ç–∫–ª—é—á–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —à—Ä–∏—Ñ—Ç–æ–≤
            cMapUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/cmaps/',
            cMapPacked: true,
        }).promise;
        
        let fullText = '';
        const totalPages = pdf.numPages;
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –±–∞—Ç—á–∞–º –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
        for (let i = 1; i <= totalPages; i += BATCH_SIZE) {
            const batchPromises = [];
            const batchEnd = Math.min(i + BATCH_SIZE - 1, totalPages);
            
            for (let pageNum = i; pageNum <= batchEnd; pageNum++) {
                batchPromises.push(
                    pdf.getPage(pageNum).then(async (page) => {
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        
                        // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        page.cleanup();
                        
                        return pageText;
                    })
                );
            }
            
            const batchTexts = await Promise.all(batchPromises);
            fullText += batchTexts.join(' ');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = Math.round((batchEnd / totalPages) * 100);
            progressCallback(file.name, progress);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
            // if (global.gc) {
            //     global.gc();
            // }
        }
        
        return fullText;
    }
    
    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
    function normalizeText(text) {
        return text.toLowerCase()
                   .replace(/\s+/g, ' ')
                   .trim();
    }
    
    // –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ –¥–ª–∏–Ω–µ
    function splitIntoSentences(text, maxSentences = 5000) {
        const sentences = text.split(/[.!?]+/)
                              .map(s => normalizeText(s))
                              .filter(s => s.length > 20);
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        if (sentences.length > maxSentences) {
            console.warn(`–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç ${sentences.length} –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π. –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–≤—ã–µ ${maxSentences}.`);
            return sentences.slice(0, maxSentences);
        }
        
        return sentences;
    }
    
    // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ñ–∞–∫–∫–∞—Ä–∞
    function jaccardSimilarity(set1, set2) {
        const intersection = new Set([...set1].filter(x => set2.has(x)));
        const union = new Set([...set1, ...set2]);
        return union.size === 0 ? 0 : (intersection.size / union.size) * 100;
    }
    
    // –û—Å–Ω–æ–≤–Ω–æ–π –∞–Ω–∞–ª–∏–∑ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
    analyzeBtn.addEventListener('click', async () => {


        results.innerHTML = '';
        analyzeBtn.disabled = true;
        
        try {
            const documents = [];
            const allSentences = [];
            const sentenceToFiles = new Map();
            
            const progressText = document.getElementById('progressText');
            const progressBarInner = document.getElementById('progressBarInner');
           const overallProgress = Math.round((completedFiles / selectedFiles.length) * 100);
progressBarInner.style.width = overallProgress + '%';
            const fileProgress = document.getElementById('fileProgress');
            
            let completedFiles = 0;
            
            // Callback –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            function updateProgress(fileName, percent) {
                fileProgress.innerHTML = `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${fileName} (${percent}%)`;
            }
            
            // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (—ç–∫–æ–Ω–æ–º–∏–º –ø–∞–º—è—Ç—å)
            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                progressText.textContent = `–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ ${i + 1} –∏–∑ ${selectedFiles.length}: ${file.name}`;
                
                const text = await extractTextFromPDFOptimized(file, updateProgress);
                const sentences = splitIntoSentences(text);
                
                documents.push({
                    name: file.name,
                    sentences: sentences,
                    sentenceSet: new Set(sentences)
                });
                
                sentences.forEach(sent => {
                    if (!sentenceToFiles.has(sent)) {
                        sentenceToFiles.set(sent, new Set());
                    }
                    sentenceToFiles.get(sent).add(file.name);
                    allSentences.push(sent);
                });
                
                completedFiles++;
                const overallProgress = Math.round((completedFiles / selectedFiles.length) * 100);
                progressBar.style.width = overallProgress + '%';
                
                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            progressText.textContent = '–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...';
            progressBar.style.width = '100%';
            
            // –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            const commonSentences = Array.from(sentenceToFiles.entries())
                .filter(([_, files]) => files.size > 1);
            const uniqueSentences = Array.from(sentenceToFiles.entries())
                .filter(([_, files]) => files.size === 1);
            
            const commonCount = allSentences.filter(s => 
                sentenceToFiles.get(s).size > 1
            ).length;
            const uniqueCount = allSentences.length - commonCount;
            
            // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ 
            let html = '<h2 style="color: #667eea; margin-bottom: 20px;">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>';
            
            // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            html += '<div class="stats-grid">';
            html += `
                <div class="stat-card">
                    <div class="stat-label">–û–±—â–∏–π —Ç–µ–∫—Å—Ç</div>
                    <div class="stat-value">${(commonCount / allSentences.length * 100).toFixed(1)}%</div>
                    <div class="stat-label">${commonCount} –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç</div>
                    <div class="stat-value">${(uniqueCount / allSentences.length * 100).toFixed(1)}%</div>
                    <div class="stat-label">${uniqueCount} –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</div>
                </div>
            `;
            html += '</div>';
            
            // –§–∏–ª—å—Ç—Ä—ã
            html += '<div class="filter-buttons">';
html += '<button class="filter-btn active" onclick="filterSentences(&quot;all&quot;, this)">–í—Å–µ</button>';
html += '<button class="filter-btn" onclick="filterSentences(&quot;unique&quot;, this)">–¢–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ</button>';
html += '<button class="filter-btn" onclick="filterSentences(&quot;common&quot;, this)">–¢–æ–ª—å–∫–æ –æ–±—â–∏–µ</button>';


            html += '</div>';
            
            // –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∞–π–ª—É
            html += '<div class="differences-section">';
            html += '<h3 style="color: #667eea; margin-bottom: 20px;">üìù –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è</h3>';

            
            documents.forEach((doc, index) => {
                const docCommon = doc.sentences.filter(s => 
                    sentenceToFiles.get(s).size > 1
                );
                const docUnique = doc.sentences.filter(s => 
                    sentenceToFiles.get(s).size === 1
                );
                
                html += `
                    <div class="file-differences">
                        <h4 onclick="toggleSentences(${index})">
                            <span>
                                <span class="toggle-icon" id="toggle-${index}">‚ñ∂</span>
                                ${doc.name}
                                <span class="sentence-badge badge-unique">${docUnique.length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö</span>
                                <span class="sentence-badge badge-common">${docCommon.length} –æ–±—â–∏—Ö</span>
                            </span>
                        </h4>
                        
                        <div class="sentences-container" id="sentences-${index}">
                            <h5 style="color: #4caf50; margin-top: 15px;">‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (${docUnique.length}):</h5>
                `;
                
if (docUnique.length > 0) {
    docUnique.forEach(sent => {
        html += `<div class="sentence-item unique-sentence" data-type="unique">${sent}</div>`;
    });
} else {
    html += '<p style="color: #666;">–ù–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>';
}

                
if (docCommon.length > 0) {
    html += `<h5 style="color: #ff9800; margin-top: 20px;">üîÑ –û–±—â–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (${docCommon.length}):</h5>`;
    docCommon.forEach(sent => {
                        const files = Array.from(sentenceToFiles.get(sent));
                        const otherFiles = files.filter(f => f !== doc.name).join(', ');
                        html += `
                            <div class="sentence-item common-sentence" data-type="common">
                                ${sent}
                                <br><small style="opacity: 0.7;">–¢–∞–∫–∂–µ –≤: ${otherFiles}</small>
                            </div>
                        `;
                    });
                    if (docCommon.length > 20) {
                        html += `<p style="color: #666; margin-top: 10px;">...–∏ –µ—â–µ ${docCommon.length - 20} –æ–±—â–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>`;
                    }
                } else {
                    html += '<p style="color: #666;">–ù–µ—Ç –æ–±—â–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>';
                }
                
                html += '</div></div>';
            });
            
            html += '</div>';
            
            // –ü–æ–ø–∞—Ä–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
            html += '<div class="comparison-matrix">';
            html += '<h3 style="color: #667eea; margin-bottom: 15px;">üîÑ –ü–æ–ø–∞—Ä–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ</h3>';
            
            for (let i = 0; i < documents.length; i++) {
                for (let j = i + 1; j < documents.length; j++) {
                    const similarity = jaccardSimilarity(
                        documents[i].sentenceSet,
                        documents[j].sentenceSet
                    );
                    
                    let cellClass = 'matrix-cell ';
                    if (similarity > 60) cellClass += 'similarity-high';
                    else if (similarity > 30) cellClass += 'similarity-medium';
                    else cellClass += 'similarity-low';
                    
                    html += `
                        <div class="${cellClass}">
                            <div style="font-size: 0.9em; margin-bottom: 5px;">
                                ${documents[i].name} ‚Üî ${documents[j].name}
                            </div>
                            <div style="font-size: 2em; font-weight: bold;">
                                ${similarity.toFixed(1)}%
                            </div>
                            <div style="font-size: 0.8em; opacity: 0.9;">
                                —Å—Ö–æ–∂–µ—Å—Ç–∏
                            </div>
                        </div>
                    `;
                }
            }
            
    results.innerHTML = html + `<div style="color: #4caf50; margin-top:20px; font-size:1.1em;">‚úÖ –ê–Ω–∞–ª–∏–∑ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!</div>`;

} catch (error) {
    results.innerHTML = `<div style="color: red; padding: 20px;">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
}
finally {
    if (!results.innerHTML.includes('color: red')) {
        setTimeout(() => {
            
            analyzeBtn.disabled = false;
        }, 1500);
    } else {
        
        analyzeBtn.disabled = false;
    }
}
    });
    
    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π 
    function toggleSentences(index) {
        const container = document.getElementById(`sentences-${index}`);
        const icon = document.getElementById(`toggle-${index}`);
        
        if (container.classList.contains('expanded')) {
            container.classList.remove('expanded');
            icon.classList.remove('expanded');
        } else {
            container.classList.add('expanded');
            icon.classList.add('expanded');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π 
function filterSentences(type, btn) {
    // –°–Ω–∏–º–∞–µ–º active —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.filter-btn').forEach(b => {
        b.classList.remove('active');
    });
    // –î–µ–ª–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—É—é
    btn.classList.add('active');
    // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ç–∏–ø—É
    document.querySelectorAll('.sentence-item').forEach(item => {
        const itemType = item.getAttribute('data-type');
        if (type === 'all') {
    item.style.display = '';
} else if (type === 'unique' && itemType === 'unique') {
            item.style.display = 'block';
        } else if (type === 'common' && itemType === 'common') {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}


</script>
</body>
</html>
